<mat-toolbar color="primary" class="header-toolbar">
  <a routerLink="/dashboard" class="logo-link">
    <span>FluxivaMed</span>
  </a>

  <span class="spacer"></span>

  <div *ngIf="isLoggedIn" class="user-actions">
    <button
      mat-icon-button
      [matMenuTriggerFor]="notificationMenu"
      aria-label="Notificações"
      (click)="markAllAsRead()"
    >
      <mat-icon
        matBadge="{{ unreadNotificationsCount > 0 ? unreadNotificationsCount : '' }}"
        matBadgeColor="warn"
        aria-hidden="false"
      >
        notifications
      </mat-icon>
    </button>
    <mat-menu #notificationMenu="matMenu">
      <button mat-menu-item disabled>
        <span>Você não tem novas notificações.</span>
      </button>
      <hr class="header-divider" role="separator" aria-hidden="true" />
      <button mat-menu-item (click)="$event.stopPropagation(); markAllAsRead()">
        <mat-icon>done_all</mat-icon>
        <span>Marcar todas como lidas</span>
      </button>
    </mat-menu>

    <div class="settings-menu-container" (click)="$event.stopPropagation()">
      <button class="action-btn" (click)="toggleSettingsMenu()" title="Configurações">
        <i class="fas fa-cog"></i>
      </button>

      <div class="settings-dropdown" [class.show]="isSettingsMenuOpen">
        <div class="settings-header">
          <span>Configurações</span>
        </div>
        <div class="settings-content">
          <label>Tema da Aplicação</label>
          <div class="theme-options">
            <button (click)="changeTheme('light')" [class.active]="currentTheme === 'light'">
              <i class="fas fa-sun"></i> Claro
            </button>
            <button (click)="changeTheme('dark')" [class.active]="currentTheme === 'dark'">
              <i class="fas fa-moon"></i> Escuro
            </button>
          </div>
          <mat-slide-toggle
            [checked]="receberEmailAprovacao"
            (change)="toggleNotificacao('receberEmailAprovacao', $event.checked)"
          >
            Receber e-mail de aprovação
          </mat-slide-toggle>
        </div>
      </div>
    </div>

    <div class="profile-menu-container" (click)="$event.stopPropagation()">
      <button class="action-btn profile-btn" (click)="toggleProfileMenu()" title="Meu Perfil">
        <i class="fas fa-user-circle"></i>
        <span>Olá, {{ userName }}</span>
        <i class="fas fa-angle-down arrow-icon" [class.rotated]="isProfileMenuOpen"></i>
      </button>

      <div class="profile-dropdown" [class.show]="isProfileMenuOpen">
        <a routerLink="/dashboard/perfil" (click)="closeAllMenus()">
          <i class="fas fa-user-edit"></i>
          <span>Meu Perfil</span>
        </a>
        <a (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Sair</span>
        </a>
      </div>
    </div>
  </div>
</mat-toolbar>
